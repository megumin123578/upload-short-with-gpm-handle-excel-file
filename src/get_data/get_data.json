(async () => {
  await new Promise(r => setTimeout(r, 2000));

  const html = document.documentElement.outerHTML;
  const blob = new Blob([html], { type: "text/html" });

  const channelElem = document.querySelector("#entity-name");
  let channelName = channelElem ? channelElem.textContent.trim() : document.title;

  let tab = "unknown";
  const href = location.href;
  if (href.includes("overview")) tab = "overview";
  else if (href.includes("content")) tab = "content";
  else if (href.includes("audience")) tab = "audience";
  else if (href.includes("research")) tab = "research";
  else if (href.includes("revenue")) tab = "revenue";

  const date = new Date().toISOString().slice(0, 10);
  channelName = channelName.replace(/[\\\\/:*?"<>|]/g, "_").replace(/\\s+/g, "_");
  const filename = `${date}_${channelName}_${tab}.html`;

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(a.href);

  console.log(`Saved full HTML: ${filename}`);
})();